name: Run
run-name: Process Notes Folder (${{ github.event_name }})

on:
  workflow_dispatch:

concurrency:
  group: group-note-processing
  cancel-in-progress: false

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    env:
      GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
      INCOMING_FOLDER_ID: '1KHCvKl1j4sutaw9GqRFxeE0ruGWowy8a'
      OUTPUT_FOLDER_ID: '1gJtAD-ta8F_xY_v8a52wetih_sBb9EHv'
      PROCESSED_FOLDER_ID: '18H68m_WsJo1tCFpmuvVHsRIq6g4q7v0p'
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      #LLM_PROVIDER:
      #LLM_MODEL:
      #MAX_FILES_PER_RUN:
      #MIN_TRANSCRIPT_CHARS:


    steps:
      - name: üß© Checkout repository
        uses: actions/checkout@v4

      - name: üêç Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: üì¶ Install Poetry
        run: |
          pip install poetry

      - name: üß∞ Install dependencies
        run: |
          poetry install
          poetry add git+https://github.com/kaianolevine/kaiano-common-utils.git

      - name: üèÉ Run processor
        run: |
          poetry run python -m notes_processor